---

- name: This playbook will setup the linux(ubuntu) servers by installing and running nginx and jdk 
  hosts: all
  become: yes

  tasks:
    - name: install nginx
      apt:
        name: nginx
        state: latest
    - name: start nginx
      service: 
        name: nginx
        state: started
        enabled: yes
    - name: install latest jdk
      apt: 
        name: default-jdk
        state: present
    - name: set JAVA_HOME environment variable globally
      lineinfile:
        path: /etc/environment
        regexp: '^JAVA_HOME='
        line: 'JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64'
        state: present
    - name: reload environment variables
      shell: source /etc/environment
      args:
        executable: /bin/bash
    - name: install latest nginx
      apt:
        name: nginx
        state: latest
    - name: start and enable nginx service
      service:
        name: nginx
        state: started
        enabled: yes
